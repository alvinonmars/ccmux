# ccmux configuration
# Commented-out values show the code defaults. Override as needed.
# Copy this file to ccmux.toml and customize for your deployment.
# ccmux.toml is gitignored (contains machine-specific paths).

[project]
# Used to form the tmux session name: ccmux-{name}
# Defaults to the basename of the working directory if not set.
# name = "my-project"

[runtime]
# Directory for FIFOs and Unix sockets. Created on startup if absent.
dir           = "/tmp/ccmux"

[timing]
# Seconds of terminal inactivity required before auto-injection is allowed.
idle_threshold   = 30
# Seconds of stdout silence that signal Claude is ready for input.
silence_timeout  = 3

[mcp]
# Port for the MCP SSE server. Binds to 127.0.0.1 only (loopback, not exposed to network).
port = 9876

[claude]
# HTTP proxy for Claude API calls. Passed as HTTP_PROXY/HTTPS_PROXY to the
# claude process in the tmux pane. ccmux itself does not use this proxy.
# proxy = "http://127.0.0.1:8118"

[recovery]
# Exponential backoff parameters for Claude process crash recovery.
backoff_initial = 1    # seconds before first restart attempt
backoff_cap     = 60   # maximum seconds between restart attempts

[whatsapp]
# Path to whatsapp-mcp's SQLite database (required for wa-notifier)
# db_path = "/path/to/whatsapp-bridge/store/messages.db"
# Polling interval in seconds (lower = faster chat response, higher = less I/O)
poll_interval = 5
# Only notify for messages from these chat IDs (empty = all chats)
# allowed_chats = ["120363...@g.us", "8526...@s.whatsapp.net"]
# Ignore group messages (only notify for 1:1 chats)
ignore_groups = true
# Admin JID for self-chat channel. Auto-detected from bridge device DB.
# Override via CCMUX_WA_ADMIN_JID env var (phone number or full JID).
# admin_jid = ""
# Enable AI classifier for noise filtering in specified chats
classify_enabled = false
smart_classify_chats = []

# ---------------------------------------------------------------------------
# Managed services — reconcile verifies these exist and have PartOf
# ---------------------------------------------------------------------------
[services]
managed = ["whatsapp-bridge", "ccmux", "ccmux-wa-notifier"]

# ---------------------------------------------------------------------------
# Timer definitions — ccmux-deploy generates systemd .timer + .service files
# Uses systemd OnCalendar syntax (not cron). Use a list for multiple triggers.
# ---------------------------------------------------------------------------
# [timers.my-task]
# description = "What this does"
# schedule = "*-*-* 08:00:00"
# exec = ".venv/bin/python3 scripts/my_script.py"
# syslog = "ccmux-my-task"
# env = { MY_VAR = "value" }
#
# [timers.startup-check]
# description = "One-shot after boot"
# startup_delay = "30s"
# exec = ".venv/bin/python3 scripts/startup_selfcheck.py"
# syslog = "ccmux-selfcheck"
